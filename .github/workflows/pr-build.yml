name: PR Build & Test

on:
    pull_request:
        branches:
            - staging
            - main
        types:
            - opened
            - synchronize
            - reopened

jobs:
    build-and-test:
        name: Build and Test
        runs-on: ubuntu-latest
        environment: ${{ github.base_ref }}

        steps:
            - name: Checkout repository
              uses: actions/checkout@v4

            - name: Setup Go
              uses: actions/setup-go@v5
              with:
                  go-version: "1.25"

            - name: Verify Go version
              run: go version

            - name: Download dependencies
              run: go mod download

            # Optional but recommended
            # - name: Check formatting
            #   run: |
            #       fmt_output=$(go fmt ./...)
            #       if [ -n "$fmt_output" ]; then
            #         echo "Files not formatted:"
            #         echo "$fmt_output"
            #         exit 1
            #       fi

            - name: Static analytic for potential bug
              run: go vet ./...

            # Optional linting (only if you want golangci-lint)
            # - name: Run golangci-lint
            #   uses: golangci/golangci-lint-action@v6
            #   with:
            #     version: latest
            #     args: --timeout 5m

            # - name: Run unit tests
            #   run: go test ./... -v

            - name: Build app (for validation)
              run: go build -o build/app ./...
